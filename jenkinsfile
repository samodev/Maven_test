pipeline {
    agent any
    stages {
        stage('Git Clone') {
            steps {
                git ([url: "https://github.com/samodev/Maven_test.git", branch: 'master'])
            }
        }
        stage('Maven Clean') {
            steps {
                sh "/opt/apache-maven-3.5.4/bin/mvn clean"
            }
        }
        stage('Maven Test') {
            steps {
                script {
                    try {
                        sh "/opt/apache-maven-3.5.4/bin/mvn test"
                    }
                    catch(e) {
                        echo "Maven test failed >> fail.log"
                        currentBuild.result="FAILED"
                    }
                }   
            }

        }
	stage('Maven Build') {
	    steps {
		sh "/opt/apache-maven-3.5.4/bin/mvn package"
	    }
	}
	stage('Maven Deploy') {
	    steps {
		sh "/opt/apache-maven-3.5.4/bin/mvn deploy"
		}
	}
	stage("condition d'affichage") {
	    steps {
	    	if (env.BRANCH_NAME =~ /^feature\/.*$/) { echo "je suis dans une branche feature" }
		if (env.BRANCH_NAME == 'develop') { echo "je suis dans une branche develop" }
	    }
	}
	stage('clean Workspace') {
	   steps { 
             cleanWs()
           }
	}
    }
}
